
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>linux_dmabuf_unstable_v1</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     
  </head>
  <body class="bg-near-white black-70 sans-serif pa2 ph6-l">

    
<div class="f3 lh-copy breadcrumbs">
  <span class="link mid-gray dim hover-pointer">
    wayland
    <div class="material-icons arrow">keyboard_arrow_down</div>
  </span>
  /
  <span class="link mid-gray dim hover-pointer">
    stable
    <div class="material-icons arrow">keyboard_arrow_down</div>
  </span>
  /
  <span class="link mid-gray dim hover-pointer">
    xdg_shell
    <div class="material-icons arrow">keyboard_arrow_down</div>
  </span>
</div>

    <div id="content">
      
  <h1 class="f1 lh-title">linux_dmabuf_unstable_v1</h1>
  <ul class="list pl0">
    
      <li>
        <div class="f2 lh-copy">
          zwp_linux_dmabuf_v1
        </div>
        <div class="f6 lh-copy ws-pre-line courier">Following the interfaces from:
https:&#x2f;&#x2f;www.khronos.org&#x2f;registry&#x2f;egl&#x2f;extensions&#x2f;EXT&#x2f;EGL_EXT_image_dma_buf_import.txt
and the Linux DRM sub-system&#x27;s AddFb2 ioctl.

This interface offers ways to create generic dmabuf-based
wl_buffers. Immediately after a client binds to this interface,
the set of supported formats and format modifiers is sent with
&#x27;format&#x27; and &#x27;modifier&#x27; events.

The following are required from clients:

- Clients must ensure that either all data in the dma-buf is
  coherent for all subsequent read access or that coherency is
  correctly handled by the underlying kernel-side dma-buf
  implementation.

- Don&#x27;t make any more attachments after sending the buffer to the
  compositor. Making more attachments later increases the risk of
  the compositor not being able to use (re-import) an existing
  dmabuf-based wl_buffer.

The underlying graphics stack must ensure the following:

- The dmabuf file descriptors relayed to the server will stay valid
  for the whole lifetime of the wl_buffer. This means the server may
  at any time use those fds to import the dmabuf into any kernel
  sub-system that might accept it.

To create a wl_buffer from one or more dmabufs, a client creates a
zwp_linux_dmabuf_params_v1 object with a zwp_linux_dmabuf_v1.create_params
request. All planes required by the intended format are added with
the &#x27;add&#x27; request. Finally, a &#x27;create&#x27; or &#x27;create_immed&#x27; request is
issued, which has the following outcome depending on the import success.

The &#x27;create&#x27; request,
- on success, triggers a &#x27;created&#x27; event which provides the final
  wl_buffer to the client.
- on failure, triggers a &#x27;failed&#x27; event to convey that the server
  cannot use the dmabufs received from the client.

For the &#x27;create_immed&#x27; request,
- on success, the server immediately imports the added dmabufs to
  create a wl_buffer. No event is sent from the server in this case.
- on failure, the server can choose to either:
  - terminate the client by raising a fatal error.
  - mark the wl_buffer as failed, and send a &#x27;failed&#x27; event to the
    client. If the client uses a failed wl_buffer as an argument to any
    request, the behaviour is compositor implementation-defined.

Warning! The protocol described in this file is experimental and
backward incompatible changes may be made. Backward compatible changes
may be added together with the corresponding interface version bump.
Backward incompatible changes are done by bumping the version number in
the protocol and interface names and resetting the interface version.
Once the protocol is to be declared stable, the &#x27;z&#x27; prefix and the
version number in the protocol and interface names are removed and the
interface version number is reset.
</div>
        <ul class="list pl0">
          
            <li>
              <div class="f4 lh-title">
                destroy
              </div>
              <div class="f5 lh-copy">
                unbind the factory
              </div>
              
<div class="f6 lh-copy courier">
  <span>void </span><span class="orange">zwp_linux_dmabuf_v1_destroy</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1</div>
    
  )
</div>
            </li>
          
            <li>
              <div class="f4 lh-title">
                create_params
              </div>
              <div class="f5 lh-copy">
                create a temporary object for buffer parameters
              </div>
              
<div class="f6 lh-copy courier">
  <span>struct zwp_linux_buffer_params_v1* </span><span class="orange">zwp_linux_dmabuf_v1_create_params</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1</div>
    
  )
</div>
            </li>
          
        </ul>
      </li>
    
      <li>
        <div class="f2 lh-copy">
          zwp_linux_buffer_params_v1
        </div>
        <div class="f6 lh-copy ws-pre-line courier">This temporary object is a collection of dmabufs and other
parameters that together form a single logical buffer. The temporary
object may eventually create one wl_buffer unless cancelled by
destroying it before requesting &#x27;create&#x27;.

Single-planar formats only require one dmabuf, however
multi-planar formats may require more than one dmabuf. For all
formats, an &#x27;add&#x27; request must be called once per plane (even if the
underlying dmabuf fd is identical).

You must use consecutive plane indices (&#x27;plane_idx&#x27; argument for &#x27;add&#x27;)
from zero to the number of planes used by the drm_fourcc format code.
All planes required by the format must be given exactly once, but can
be given in any order. Each plane index can be set only once.
</div>
        <ul class="list pl0">
          
            <li>
              <div class="f4 lh-title">
                destroy
              </div>
              <div class="f5 lh-copy">
                delete this object, used or not
              </div>
              
<div class="f6 lh-copy courier">
  <span>void </span><span class="orange">zwp_linux_buffer_params_v1_destroy</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1</div>
    
  )
</div>
            </li>
          
            <li>
              <div class="f4 lh-title">
                add
              </div>
              <div class="f5 lh-copy">
                add a dmabuf to the temporary set
              </div>
              
<div class="f6 lh-copy courier">
  <span>void </span><span class="orange">zwp_linux_buffer_params_v1_add</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> fd,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> plane_idx,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> offset,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> stride,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> modifier_hi,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> modifier_lo</div>
    
  )
</div>
            </li>
          
            <li>
              <div class="f4 lh-title">
                create
              </div>
              <div class="f5 lh-copy">
                create a wl_buffer from the given dmabufs
              </div>
              
<div class="f6 lh-copy courier">
  <span>void </span><span class="orange">zwp_linux_buffer_params_v1_create</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> width,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> height,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> format,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> flags</div>
    
  )
</div>
            </li>
          
            <li>
              <div class="f4 lh-title">
                create_immed
              </div>
              <div class="f5 lh-copy">
                immediately create a wl_buffer from the given
dmabufs
              </div>
              
<div class="f6 lh-copy courier">
  <span>struct wl_buffer* </span><span class="orange">zwp_linux_buffer_params_v1_create_immed</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> width,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> height,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> format,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> flags</div>
    
  )
</div>
            </li>
          
        </ul>
      </li>
    
  </ul>

  <h2 class="f2 lh-title">Copyright Info</h2>
  <div class="f6 lh-copy ws-pre-line courier">Copyright Â© 2014, 2015 Collabora, Ltd.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the &quot;Software&quot;),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and&#x2f;or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice (including the next
paragraph) shall be included in all copies or substantial portions of the
Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.
</div>

    </div>

    <script src="/bundle.js"></script>
  </body>
</html>