
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>linux_dmabuf_v1</title>

    <link rel="stylesheet" href="/wayland-protocol-docs/main.css">
     
  </head>
  <body class="black-70 flex sans-serif ph4-l">
    <div id="sidebar" class="w-20">
      <div class="fixed vh-100 overflow-y-auto w-20">
        <a href="/wayland-protocol-docs/" class="f4 link near-black dim lh-title db mt3">
          Home
        </a>
        
  <div class="ph2">
    

<div>
  <ul class="list pl0">
  
    <li>
      <a href="#i:zwp_linux_dmabuf_v1" class="link blue underline-hover lh-copy">zwp_linux_dmabuf_v1</a>

      
        <div>
          <a href="#rh:zwp_linux_dmabuf_v1" class="link blue underline-hover lh-copy pl3">Requests</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#r:zwp_linux_dmabuf_v1:destroy" class="link blue underline-hover lh-copy">destroy</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_dmabuf_v1:create_params" class="link blue underline-hover lh-copy">create_params</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_dmabuf_v1:get_default_feedback" class="link blue underline-hover lh-copy">get_default_feedback</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_dmabuf_v1:get_surface_feedback" class="link blue underline-hover lh-copy">get_surface_feedback</a>
          </li>
          
        </ul>
      

      
        <div>
          <a href="#eh:zwp_linux_dmabuf_v1" class="link blue underline-hover lh-copy pl3">Events</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#e:zwp_linux_dmabuf_v1:format" class="link blue underline-hover lh-copy">format</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_v1:modifier" class="link blue underline-hover lh-copy">modifier</a>
          </li>
          
        </ul>
      

      
      
    </li>
  
    <li>
      <a href="#i:zwp_linux_buffer_params_v1" class="link blue underline-hover lh-copy">zwp_linux_buffer_params_v1</a>

      
        <div>
          <a href="#rh:zwp_linux_buffer_params_v1" class="link blue underline-hover lh-copy pl3">Requests</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#r:zwp_linux_buffer_params_v1:destroy" class="link blue underline-hover lh-copy">destroy</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_buffer_params_v1:add" class="link blue underline-hover lh-copy">add</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_buffer_params_v1:create" class="link blue underline-hover lh-copy">create</a>
          </li>
          
          <li>
            <a href="#r:zwp_linux_buffer_params_v1:create_immed" class="link blue underline-hover lh-copy">create_immed</a>
          </li>
          
        </ul>
      

      
        <div>
          <a href="#eh:zwp_linux_buffer_params_v1" class="link blue underline-hover lh-copy pl3">Events</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#e:zwp_linux_buffer_params_v1:created" class="link blue underline-hover lh-copy">created</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_buffer_params_v1:failed" class="link blue underline-hover lh-copy">failed</a>
          </li>
          
        </ul>
      

      
        <div>
          <a href="#enumh:zwp_linux_buffer_params_v1" class="link blue underline-hover lh-copy pl3">Enums</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#enum:zwp_linux_buffer_params_v1:error" class="link blue underline-hover lh-copy">error</a>
          </li>
          
          <li>
            <a href="#enum:zwp_linux_buffer_params_v1:flags" class="link blue underline-hover lh-copy">flags</a>
          </li>
          
        </ul>
      
    </li>
  
    <li>
      <a href="#i:zwp_linux_dmabuf_feedback_v1" class="link blue underline-hover lh-copy">zwp_linux_dmabuf_feedback_v1</a>

      
        <div>
          <a href="#rh:zwp_linux_dmabuf_feedback_v1" class="link blue underline-hover lh-copy pl3">Requests</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#r:zwp_linux_dmabuf_feedback_v1:destroy" class="link blue underline-hover lh-copy">destroy</a>
          </li>
          
        </ul>
      

      
        <div>
          <a href="#eh:zwp_linux_dmabuf_feedback_v1" class="link blue underline-hover lh-copy pl3">Events</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:done" class="link blue underline-hover lh-copy">done</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:format_table" class="link blue underline-hover lh-copy">format_table</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:main_device" class="link blue underline-hover lh-copy">main_device</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_done" class="link blue underline-hover lh-copy">tranche_done</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_target_device" class="link blue underline-hover lh-copy">tranche_target_device</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_formats" class="link blue underline-hover lh-copy">tranche_formats</a>
          </li>
          
          <li>
            <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_flags" class="link blue underline-hover lh-copy">tranche_flags</a>
          </li>
          
        </ul>
      

      
        <div>
          <a href="#enumh:zwp_linux_dmabuf_feedback_v1" class="link blue underline-hover lh-copy pl3">Enums</a>
        </div>
        <ul class="list pl4">
          
          <li>
            <a href="#enum:zwp_linux_dmabuf_feedback_v1:tranche_flags" class="link blue underline-hover lh-copy">tranche_flags</a>
          </li>
          
        </ul>
      
    </li>
  
  </ul>
</div>
  </div>

      </div>
    </div>

    <main id="content" class="mh4 w-80">
      
  <div class="ph2">
    <h1 class="f1 lh-title">linux_dmabuf_v1</h1>
    <ul class="list pl0">
      
      <li class="mt4">
        <h2 class="f2 lh-copy hide-child relative flex items-baseline" id="i:zwp_linux_dmabuf_v1">
          <a href="#i:zwp_linux_dmabuf_v1" class="link dim black-70 child pr2 absolute left--2">#</a>
          zwp_linux_dmabuf_v1
        </h2>
        <div class="f6 lh-copy ws-pre-line code">Following the interfaces from:
https://www.khronos.org/registry/egl/extensions/EXT/EGL_EXT_image_dma_buf_import.txt
https://www.khronos.org/registry/EGL/extensions/EXT/EGL_EXT_image_dma_buf_import_modifiers.txt
and the Linux DRM sub-system&#x27;s AddFb2 ioctl.

This interface offers ways to create generic dmabuf-based wl_buffers.

Clients can use the get_surface_feedback request to get dmabuf feedback
for a particular surface. If the client wants to retrieve feedback not
tied to a surface, they can use the get_default_feedback request.

The following are required from clients:

- Clients must ensure that either all data in the dma-buf is
  coherent for all subsequent read access or that coherency is
  correctly handled by the underlying kernel-side dma-buf
  implementation.

- Don&#x27;t make any more attachments after sending the buffer to the
  compositor. Making more attachments later increases the risk of
  the compositor not being able to use (re-import) an existing
  dmabuf-based wl_buffer.

The underlying graphics stack must ensure the following:

- The dmabuf file descriptors relayed to the server will stay valid
  for the whole lifetime of the wl_buffer. This means the server may
  at any time use those fds to import the dmabuf into any kernel
  sub-system that might accept it.

However, when the underlying graphics stack fails to deliver the
promise, because of e.g. a device hot-unplug which raises internal
errors, after the wl_buffer has been successfully created the
compositor must not raise protocol errors to the client when dmabuf
import later fails.

To create a wl_buffer from one or more dmabufs, a client creates a
zwp_linux_dmabuf_params_v1 object with a zwp_linux_dmabuf_v1.create_params
request. All planes required by the intended format are added with
the &#x27;add&#x27; request. Finally, a &#x27;create&#x27; or &#x27;create_immed&#x27; request is
issued, which has the following outcome depending on the import success.

The &#x27;create&#x27; request,
- on success, triggers a &#x27;created&#x27; event which provides the final
  wl_buffer to the client.
- on failure, triggers a &#x27;failed&#x27; event to convey that the server
  cannot use the dmabufs received from the client.

For the &#x27;create_immed&#x27; request,
- on success, the server immediately imports the added dmabufs to
  create a wl_buffer. No event is sent from the server in this case.
- on failure, the server can choose to either:
  - terminate the client by raising a fatal error.
  - mark the wl_buffer as failed, and send a &#x27;failed&#x27; event to the
    client. If the client uses a failed wl_buffer as an argument to any
    request, the behaviour is compositor implementation-defined.

For all DRM formats and unless specified in another protocol extension,
pre-multiplied alpha is used for pixel values.

Unless specified otherwise in another protocol extension, implicit
synchronization is used. In other words, compositors and clients must
wait and signal fences implicitly passed via the DMA-BUF&#x27;s reservation
mechanism.
</div>

        
          <h3 class=" f5 lh-title" id="rh:zwp_linux_dmabuf_v1">Requests</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_dmabuf_v1:destroy">
                <a href="#r:zwp_linux_dmabuf_v1:destroy" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  destroy
                </div>
                <div class="f5 ml2">
                  unbind the factory
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>void </span><span class="dark-blue">zwp_linux_dmabuf_v1_destroy</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">Objects created through this interface, especially wl_buffers, will
remain valid.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_dmabuf_v1:create_params">
                <a href="#r:zwp_linux_dmabuf_v1:create_params" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  create_params
                </div>
                <div class="f5 ml2">
                  create a temporary object for buffer parameters
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>struct zwp_linux_buffer_params_v1* </span><span class="dark-blue">zwp_linux_dmabuf_v1_create_params</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This temporary object is used to collect multiple dmabuf handles into
a single batch to create a wl_buffer. It can only be used once and
should be destroyed after a &#x27;created&#x27; or &#x27;failed&#x27; event has been
received.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_dmabuf_v1:get_default_feedback">
                <a href="#r:zwp_linux_dmabuf_v1:get_default_feedback" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  get_default_feedback
                </div>
                <div class="f5 ml2">
                  get default feedback
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>struct zwp_linux_dmabuf_feedback_v1* </span><span class="dark-blue">zwp_linux_dmabuf_v1_get_default_feedback</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This request creates a new wp_linux_dmabuf_feedback object not bound
to a particular surface. This object will deliver feedback about dmabuf
parameters to use if the client doesn&#x27;t support per-surface feedback
(see get_surface_feedback).
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_dmabuf_v1:get_surface_feedback">
                <a href="#r:zwp_linux_dmabuf_v1:get_surface_feedback" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  get_surface_feedback
                </div>
                <div class="f5 ml2">
                  get feedback for a surface
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>struct zwp_linux_dmabuf_feedback_v1* </span><span class="dark-blue">zwp_linux_dmabuf_v1_get_surface_feedback</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_v1*</span> zwp_linux_dmabuf_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">struct wl_surface*</span> surface</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This request creates a new wp_linux_dmabuf_feedback object for the
specified wl_surface. This object will deliver feedback about dmabuf
parameters to use for buffers attached to this surface.

If the surface is destroyed before the wp_linux_dmabuf_feedback object,
the feedback object becomes inert.
</div>
            </li>
            
          </ul>
        

        
          <h3 class=" f5 lh-title" id="eh:zwp_linux_dmabuf_v1">Events</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_v1:format">
                <a href="#e:zwp_linux_dmabuf_v1:format" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  format
                </div>
                <div class="f5 ml2">
                  supported buffer format
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> format <span class="green">/* DRM_FORMAT code */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event advertises one buffer format that the server supports.
All the supported formats are advertised once when the client
binds to this interface. A roundtrip after binding guarantees
that the client has received all supported formats.

For the definition of the format codes, see the
zwp_linux_buffer_params_v1::create request.

Starting version 4, the format event is deprecated and must not be
sent by compositors. Instead, use get_default_feedback or
get_surface_feedback.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_v1:modifier">
                <a href="#e:zwp_linux_dmabuf_v1:modifier" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  modifier
                </div>
                <div class="f5 ml2">
                  supported buffer format modifier
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> format <span class="green">/* DRM_FORMAT code */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> modifier_hi <span class="green">/* high 32 bits of layout modifier */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> modifier_lo <span class="green">/* low 32 bits of layout modifier */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event advertises the formats that the server supports, along with
the modifiers supported for each format. All the supported modifiers
for all the supported formats are advertised once when the client
binds to this interface. A roundtrip after binding guarantees that
the client has received all supported format-modifier pairs.

For legacy support, DRM_FORMAT_MOD_INVALID (that is, modifier_hi ==
0x00ffffff and modifier_lo == 0xffffffff) is allowed in this event.
It indicates that the server can support the format with an implicit
modifier. When a plane has DRM_FORMAT_MOD_INVALID as its modifier, it
is as if no explicit modifier is specified. The effective modifier
will be derived from the dmabuf.

A compositor that sends valid modifiers and DRM_FORMAT_MOD_INVALID for
a given format supports both explicit modifiers and implicit modifiers.

For the definition of the format and modifier codes, see the
zwp_linux_buffer_params_v1::create and zwp_linux_buffer_params_v1::add
requests.

Starting version 4, the modifier event is deprecated and must not be
sent by compositors. Instead, use get_default_feedback or
get_surface_feedback.
</div>
            </li>
            
          </ul>

        

        

        

      </li>
      
      <li class="mt4">
        <h2 class="f2 lh-copy hide-child relative flex items-baseline" id="i:zwp_linux_buffer_params_v1">
          <a href="#i:zwp_linux_buffer_params_v1" class="link dim black-70 child pr2 absolute left--2">#</a>
          zwp_linux_buffer_params_v1
        </h2>
        <div class="f6 lh-copy ws-pre-line code">This temporary object is a collection of dmabufs and other
parameters that together form a single logical buffer. The temporary
object may eventually create one wl_buffer unless cancelled by
destroying it before requesting &#x27;create&#x27;.

Single-planar formats only require one dmabuf, however
multi-planar formats may require more than one dmabuf. For all
formats, an &#x27;add&#x27; request must be called once per plane (even if the
underlying dmabuf fd is identical).

You must use consecutive plane indices (&#x27;plane_idx&#x27; argument for &#x27;add&#x27;)
from zero to the number of planes used by the drm_fourcc format code.
All planes required by the format must be given exactly once, but can
be given in any order. Each plane index can be set only once.
</div>

        
          <h3 class=" f5 lh-title" id="rh:zwp_linux_buffer_params_v1">Requests</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_buffer_params_v1:destroy">
                <a href="#r:zwp_linux_buffer_params_v1:destroy" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  destroy
                </div>
                <div class="f5 ml2">
                  delete this object, used or not
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>void </span><span class="dark-blue">zwp_linux_buffer_params_v1_destroy</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">Cleans up the temporary data sent to the server for dmabuf-based
wl_buffer creation.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_buffer_params_v1:add">
                <a href="#r:zwp_linux_buffer_params_v1:add" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  add
                </div>
                <div class="f5 ml2">
                  add a dmabuf to the temporary set
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>void </span><span class="dark-blue">zwp_linux_buffer_params_v1_add</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> fd, <span class="green">/* dmabuf fd */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> plane_idx, <span class="green">/* plane index */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> offset, <span class="green">/* offset in bytes */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> stride, <span class="green">/* stride in bytes */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> modifier_hi, <span class="green">/* high 32 bits of layout modifier */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> modifier_lo <span class="green">/* low 32 bits of layout modifier */</span></div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This request adds one dmabuf to the set in this
zwp_linux_buffer_params_v1.

The 64-bit unsigned value combined from modifier_hi and modifier_lo
is the dmabuf layout modifier. DRM AddFB2 ioctl calls this the
fb modifier, which is defined in drm_mode.h of Linux UAPI.
This is an opaque token. Drivers use this token to express tiling,
compression, etc. driver-specific modifications to the base format
defined by the DRM fourcc code.

Starting from version 4, the invalid_format protocol error is sent if
the format + modifier pair was not advertised as supported.

This request raises the PLANE_IDX error if plane_idx is too large.
The error PLANE_SET is raised if attempting to set a plane that
was already set.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_buffer_params_v1:create">
                <a href="#r:zwp_linux_buffer_params_v1:create" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  create
                </div>
                <div class="f5 ml2">
                  create a wl_buffer from the given dmabufs
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>void </span><span class="dark-blue">zwp_linux_buffer_params_v1_create</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> width, <span class="green">/* base plane width in pixels */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> height, <span class="green">/* base plane height in pixels */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> format, <span class="green">/* DRM_FORMAT code */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> flags <span class="green">/* see enum flags */</span></div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This asks for creation of a wl_buffer from the added dmabuf
buffers. The wl_buffer is not created immediately but returned via
the &#x27;created&#x27; event if the dmabuf sharing succeeds. The sharing
may fail at runtime for reasons a client cannot predict, in
which case the &#x27;failed&#x27; event is triggered.

The &#x27;format&#x27; argument is a DRM_FORMAT code, as defined by the
libdrm&#x27;s drm_fourcc.h. The Linux kernel&#x27;s DRM sub-system is the
authoritative source on how the format codes should work.

The &#x27;flags&#x27; is a bitfield of the flags defined in enum &quot;flags&quot;.
&#x27;y_invert&#x27; means the that the image needs to be y-flipped.

Flag &#x27;interlaced&#x27; means that the frame in the buffer is not
progressive as usual, but interlaced. An interlaced buffer as
supported here must always contain both top and bottom fields.
The top field always begins on the first pixel row. The temporal
ordering between the two fields is top field first, unless
&#x27;bottom_first&#x27; is specified. It is undefined whether &#x27;bottom_first&#x27;
is ignored if &#x27;interlaced&#x27; is not set.

This protocol does not convey any information about field rate,
duration, or timing, other than the relative ordering between the
two fields in one buffer. A compositor may have to estimate the
intended field rate from the incoming buffer rate. It is undefined
whether the time of receiving wl_surface.commit with a new buffer
attached, applying the wl_surface state, wl_surface.frame callback
trigger, presentation, or any other point in the compositor cycle
is used to measure the frame or field times. There is no support
for detecting missed or late frames/fields/buffers either, and
there is no support whatsoever for cooperating with interlaced
compositor output.

The composited image quality resulting from the use of interlaced
buffers is explicitly undefined. A compositor may use elaborate
hardware features or software to deinterlace and create progressive
output frames from a sequence of interlaced input buffers, or it
may produce substandard image quality. However, compositors that
cannot guarantee reasonable image quality in all cases are recommended
to just reject all interlaced buffers.

Any argument errors, including non-positive width or height,
mismatch between the number of planes and the format, bad
format, bad offset or stride, may be indicated by fatal protocol
errors: INCOMPLETE, INVALID_FORMAT, INVALID_DIMENSIONS,
OUT_OF_BOUNDS.

Dmabuf import errors in the server that are not obvious client
bugs are returned via the &#x27;failed&#x27; event as non-fatal. This
allows attempting dmabuf sharing and falling back in the client
if it fails.

This request can be sent only once in the object&#x27;s lifetime, after
which the only legal request is destroy. This object should be
destroyed after issuing a &#x27;create&#x27; request. Attempting to use this
object after issuing &#x27;create&#x27; raises ALREADY_USED protocol error.

It is not mandatory to issue &#x27;create&#x27;. If a client wants to
cancel the buffer creation, it can just destroy this object.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_buffer_params_v1:create_immed">
                <a href="#r:zwp_linux_buffer_params_v1:create_immed" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  create_immed
                </div>
                <div class="f5 ml2">
                  immediately create a wl_buffer from the given
dmabufs
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>struct wl_buffer* </span><span class="dark-blue">zwp_linux_buffer_params_v1_create_immed</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_buffer_params_v1*</span> zwp_linux_buffer_params_v1,</div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> width, <span class="green">/* base plane width in pixels */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">int32_t</span> height, <span class="green">/* base plane height in pixels */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> format, <span class="green">/* DRM_FORMAT code */</span></div>
    
      <div class="ws-pre-wrap">    <span class="purple">uint32_t</span> flags <span class="green">/* see enum flags */</span></div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">This asks for immediate creation of a wl_buffer by importing the
added dmabufs.

In case of import success, no event is sent from the server, and the
wl_buffer is ready to be used by the client.

Upon import failure, either of the following may happen, as seen fit
by the implementation:
- the client is terminated with one of the following fatal protocol
  errors:
  - INCOMPLETE, INVALID_FORMAT, INVALID_DIMENSIONS, OUT_OF_BOUNDS,
    in case of argument errors such as mismatch between the number
    of planes and the format, bad format, non-positive width or
    height, or bad offset or stride.
  - INVALID_WL_BUFFER, in case the cause for failure is unknown or
    plaform specific.
- the server creates an invalid wl_buffer, marks it as failed and
  sends a &#x27;failed&#x27; event to the client. The result of using this
  invalid wl_buffer as an argument in any request by the client is
  defined by the compositor implementation.

This takes the same arguments as a &#x27;create&#x27; request, and obeys the
same restrictions.
</div>
            </li>
            
          </ul>
        

        
          <h3 class=" f5 lh-title" id="eh:zwp_linux_buffer_params_v1">Events</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_buffer_params_v1:created">
                <a href="#e:zwp_linux_buffer_params_v1:created" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  created
                </div>
                <div class="f5 ml2">
                  buffer creation succeeded
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">struct wl_buffer*</span> buffer <span class="green">/* the newly created wl_buffer */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event indicates that the attempted buffer creation was
successful. It provides the new wl_buffer referencing the dmabuf(s).

Upon receiving this event, the client should destroy the
zwp_linux_buffer_params_v1 object.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_buffer_params_v1:failed">
                <a href="#e:zwp_linux_buffer_params_v1:failed" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  failed
                </div>
                <div class="f5 ml2">
                  buffer creation failed
                </div>
              </div>

              

              <div class="f6 lh-copy ws-pre-line code mt3">This event indicates that the attempted buffer creation has
failed. It usually means that one of the dmabuf constraints
has not been fulfilled.

Upon receiving this event, the client should destroy the
zwp_linux_buffer_params_v1 object.
</div>
            </li>
            
          </ul>

        

        
          <h3 class=" f5 lh-title" id="enumh:zwp_linux_buffer_params_v1">Enums</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="enum:zwp_linux_buffer_params_v1:error">
                <a href="#enum:zwp_linux_buffer_params_v1:error" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  error
                </div>
                <div class="f5 ml2">
                  
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_ALREADY_USED  <span class="green">/* the dmabuf_batch object has already been used to create a wl_buffer */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_PLANE_IDX  <span class="green">/* plane index out of bounds */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_PLANE_SET  <span class="green">/* the plane index was already set */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_INCOMPLETE  <span class="green">/* missing or too many planes to create a buffer */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_INVALID_FORMAT  <span class="green">/* format not supported */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_INVALID_DIMENSIONS  <span class="green">/* invalid width or height */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_OUT_OF_BOUNDS  <span class="green">/* offset + stride * height goes out of dmabuf bounds */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_ERROR_INVALID_WL_BUFFER  <span class="green">/* invalid wl_buffer resulted from importing dmabufs via
               the create_immed request on given buffer_params */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3"></div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="enum:zwp_linux_buffer_params_v1:flags">
                <a href="#enum:zwp_linux_buffer_params_v1:flags" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  flags
                </div>
                <div class="f5 ml2">
                  
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_FLAGS_Y_INVERT  <span class="green">/* contents are y-inverted */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_FLAGS_INTERLACED  <span class="green">/* content is interlaced */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_BUFFER_PARAMS_V1_FLAGS_BOTTOM_FIRST  <span class="green">/* bottom field first */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3"></div>
            </li>
            
          </ul>

        

      </li>
      
      <li class="mt4">
        <h2 class="f2 lh-copy hide-child relative flex items-baseline" id="i:zwp_linux_dmabuf_feedback_v1">
          <a href="#i:zwp_linux_dmabuf_feedback_v1" class="link dim black-70 child pr2 absolute left--2">#</a>
          zwp_linux_dmabuf_feedback_v1
        </h2>
        <div class="f6 lh-copy ws-pre-line code">This object advertises dmabuf parameters feedback. This includes the
preferred devices and the supported formats/modifiers.

The parameters are sent once when this object is created and whenever they
change. The done event is always sent once after all parameters have been
sent. When a single parameter changes, all parameters are re-sent by the
compositor.

Compositors can re-send the parameters when the current client buffer
allocations are sub-optimal. Compositors should not re-send the
parameters if re-allocating the buffers would not result in a more optimal
configuration. In particular, compositors should avoid sending the exact
same parameters multiple times in a row.

The tranche_target_device and tranche_formats events are grouped by
tranches of preference. For each tranche, a tranche_target_device, one
tranche_flags and one or more tranche_formats events are sent, followed
by a tranche_done event finishing the list. The tranches are sent in
descending order of preference. All formats and modifiers in the same
tranche have the same preference.

To send parameters, the compositor sends one main_device event, tranches
(each consisting of one tranche_target_device event, one tranche_flags
event, tranche_formats events and then a tranche_done event), then one
done event.
</div>

        
          <h3 class=" f5 lh-title" id="rh:zwp_linux_dmabuf_feedback_v1">Requests</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="r:zwp_linux_dmabuf_feedback_v1:destroy">
                <a href="#r:zwp_linux_dmabuf_feedback_v1:destroy" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  destroy
                </div>
                <div class="f5 ml2">
                  destroy the feedback object
                </div>
              </div>
              
<div class="f6 lh-copy code">
  <span>void </span><span class="dark-blue">zwp_linux_dmabuf_feedback_v1_destroy</span>(
    
      <div class="ws-pre-wrap">    <span class="purple">struct zwp_linux_dmabuf_feedback_v1*</span> zwp_linux_dmabuf_feedback_v1</div>
    
  )
</div>
              <div class="f6 lh-copy ws-pre-line code">Using this request a client can tell the server that it is not going to
use the wp_linux_dmabuf_feedback object anymore.
</div>
            </li>
            
          </ul>
        

        
          <h3 class=" f5 lh-title" id="eh:zwp_linux_dmabuf_feedback_v1">Events</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:done">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:done" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  done
                </div>
                <div class="f5 ml2">
                  all feedback has been sent
                </div>
              </div>

              

              <div class="f6 lh-copy ws-pre-line code mt3">This event is sent after all parameters of a wp_linux_dmabuf_feedback
object have been sent.

This allows changes to the wp_linux_dmabuf_feedback parameters to be
seen as atomic, even if they happen via multiple events.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:format_table">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:format_table" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  format_table
                </div>
                <div class="f5 ml2">
                  format and modifier table
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">int32_t</span> fd <span class="green">/* table file descriptor */</span> 
                </div>
              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> size <span class="green">/* table size, in bytes */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event provides a file descriptor which can be memory-mapped to
access the format and modifier table.

The table contains a tightly packed array of consecutive format +
modifier pairs. Each pair is 16 bytes wide. It contains a format as a
32-bit unsigned integer, followed by 4 bytes of unused padding, and a
modifier as a 64-bit unsigned integer. The native endianness is used.

The client must map the file descriptor in read-only private mode.

Compositors are not allowed to mutate the table file contents once this
event has been sent. Instead, compositors must create a new, separate
table file and re-send feedback parameters. Compositors are allowed to
store duplicate format + modifier pairs in the table.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:main_device">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:main_device" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  main_device
                </div>
                <div class="f5 ml2">
                  preferred main device
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">struct wl_array*</span> device <span class="green">/* device dev_t value */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event advertises the main device that the server prefers to use
when direct scan-out to the target device isn&#x27;t possible. The
advertised main device may be different for each
wp_linux_dmabuf_feedback object, and may change over time.

There is exactly one main device. The compositor must send at least
one preference tranche with tranche_target_device equal to main_device.

Clients need to create buffers that the main device can import and
read from, otherwise creating the dmabuf wl_buffer will fail (see the
wp_linux_buffer_params.create and create_immed requests for details).
The main device will also likely be kept active by the compositor,
so clients can use it instead of waking up another device for power
savings.

In general the device is a DRM node. The DRM node type (primary vs.
render) is unspecified. Clients must not rely on the compositor sending
a particular node type. Clients cannot check two devices for equality
by comparing the dev_t value.

If explicit modifiers are not supported and the client performs buffer
allocations on a different device than the main device, then the client
must force the buffer to have a linear layout.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:tranche_done">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_done" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  tranche_done
                </div>
                <div class="f5 ml2">
                  a preference tranche has been sent
                </div>
              </div>

              

              <div class="f6 lh-copy ws-pre-line code mt3">This event splits tranche_target_device and tranche_formats events in
preference tranches. It is sent after a set of tranche_target_device
and tranche_formats events; it represents the end of a tranche. The
next tranche will have a lower preference.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:tranche_target_device">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_target_device" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  tranche_target_device
                </div>
                <div class="f5 ml2">
                  target device
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">struct wl_array*</span> device <span class="green">/* device dev_t value */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event advertises the target device that the server prefers to use
for a buffer created given this tranche. The advertised target device
may be different for each preference tranche, and may change over time.

There is exactly one target device per tranche.

The target device may be a scan-out device, for example if the
compositor prefers to directly scan-out a buffer created given this
tranche. The target device may be a rendering device, for example if
the compositor prefers to texture from said buffer.

The client can use this hint to allocate the buffer in a way that makes
it accessible from the target device, ideally directly. The buffer must
still be accessible from the main device, either through direct import
or through a potentially more expensive fallback path. If the buffer
can&#x27;t be directly imported from the main device then clients must be
prepared for the compositor changing the tranche priority or making
wl_buffer creation fail (see the wp_linux_buffer_params.create and
create_immed requests for details).

If the device is a DRM node, the DRM node type (primary vs. render) is
unspecified. Clients must not rely on the compositor sending a
particular node type. Clients cannot check two devices for equality by
comparing the dev_t value.

This event is tied to a preference tranche, see the tranche_done event.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:tranche_formats">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_formats" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  tranche_formats
                </div>
                <div class="f5 ml2">
                  supported buffer format modifier
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">struct wl_array*</span> indices <span class="green">/* array of 16-bit indexes */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event advertises the format + modifier combinations that the
compositor supports.

It carries an array of indices, each referring to a format + modifier
pair in the last received format table (see the format_table event).
Each index is a 16-bit unsigned integer in native endianness.

For legacy support, DRM_FORMAT_MOD_INVALID is an allowed modifier.
It indicates that the server can support the format with an implicit
modifier. When a buffer has DRM_FORMAT_MOD_INVALID as its modifier, it
is as if no explicit modifier is specified. The effective modifier
will be derived from the dmabuf.

A compositor that sends valid modifiers and DRM_FORMAT_MOD_INVALID for
a given format supports both explicit modifiers and implicit modifiers.

Compositors must not send duplicate format + modifier pairs within the
same tranche or across two different tranches with the same target
device and flags.

This event is tied to a preference tranche, see the tranche_done event.

For the definition of the format and modifier codes, see the
wp_linux_buffer_params.create request.
</div>
            </li>
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="e:zwp_linux_dmabuf_feedback_v1:tranche_flags">
                <a href="#e:zwp_linux_dmabuf_feedback_v1:tranche_flags" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  tranche_flags
                </div>
                <div class="f5 ml2">
                  tranche flags
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  <span class="purple">uint32_t</span> flags <span class="green">/* tranche flags */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3">This event sets tranche-specific flags.

The scanout flag is a hint that direct scan-out may be attempted by the
compositor on the target device if the client appropriately allocates a
buffer. How to allocate a buffer that can be scanned out on the target
device is implementation-defined.

This event is tied to a preference tranche, see the tranche_done event.
</div>
            </li>
            
          </ul>

        

        
          <h3 class=" f5 lh-title" id="enumh:zwp_linux_dmabuf_feedback_v1">Enums</h3>
          <ul class="list pl0">
            
            <li class="mt3">
              <div class="flex items-baseline lh-title mb2 hide-child relative" id="enum:zwp_linux_dmabuf_feedback_v1:tranche_flags">
                <a href="#enum:zwp_linux_dmabuf_feedback_v1:tranche_flags" class="link dim black-70 child pr1 absolute left--1 hash-link-entry">#</a>
                <div class="f4">
                  tranche_flags
                </div>
                <div class="f5 ml2">
                  
                </div>
              </div>

              
                <div class="f6 lh-copy code">
                  ZWP_LINUX_DMABUF_FEEDBACK_V1_TRANCHE_FLAGS_SCANOUT  <span class="green">/* direct scan-out tranche */</span> 
                </div>
              

              <div class="f6 lh-copy ws-pre-line code mt3"></div>
            </li>
            
          </ul>

        

      </li>
      
    </ul>

    <h2 class="f4 lh-title">Copyright Info</h2>
    <div class="f7 lh-copy ws-pre-line code">Copyright  2014, 2015 Collabora, Ltd.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the &quot;Software&quot;),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice (including the next
paragraph) shall be included in all copies or substantial portions of the
Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.
</div>
  </div>

    </main>

  </body>
</html>